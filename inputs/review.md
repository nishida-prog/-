## 着手順（優先度つきの最小ルート）

### 1. “線の意味”を先に決める（実装より前）

**目的：** 図を見た瞬間に「どのデータが、どのシステムのデータと関わるか」を誤読なく伝える

* [ ] **線種を2〜3種類に限定**して定義する（増やしすぎない）

  * 例）

    * 実線：主要な業務フロー（受注→出荷→請求→入金、発注→入荷→支払）
    * 点線：マスタ参照（品目、取引先、拠点など）
    * 太線：システム境界を跨ぐ関係（視認性優先）
* [ ] **矢印の向きルール**を決める（どっちでもいいが統一）

  * 例）「プロセス順に左→右」or「参照（FK）→参照先（PK）」
* [ ] **多重度表記の採用範囲**を決める

  * 鳥瞰：原則 “1–N” くらいの最小限のみ
  * 骨格：1 / N / 0..1 を必須（レビュー要求）

---

### 2. “関係線を描く部品”を共通化して作る（鳥瞰→骨格に使い回す）

**目的：** 「格子線」ではなく「ERの関係線」に見える表現を、HTML/CSSだけで成立させる

* [ ] **関係線レイヤ**を追加（おすすめ：SVGオーバーレイ）

  * HTML内に `<svg>` を重ねるだけなので **JS不要**、矢印・ラベル・多重度が素直に描けます
* [ ] 線の視認性を上げるCSSを作る

  * [ ] 線（stroke幅、点線、透明度）
  * [ ] 矢印（marker）
  * [ ] ラベル（白背景のチップにして線と重なっても読めるように）
* [ ] 凡例（Legend）に **「色」＋「線」＋「多重度」** を追加（テンプレ固定枠）

> ここを先に作ると、鳥瞰も骨格も「線を足す作業」が同じやり方で回せます。

---

## タスク分解（テンプレ別）

## A. 鳥瞰データモデル図（あなたの狙い＝“図だけで関わりが分かる”を最短で実現）

### A-1. 既存の格子線を“関係線と誤認されない”ように処理

（レビューで指摘されている痛点を先に潰す）

* [ ] `.conn`（格子線）を削除、または **極薄い区切り線**へ格下げ

  * 例）色を薄いグレー、線幅1px、破線にする等
* [ ] 区切り線を残すなら、注釈を追加（「システム境界」など）

### A-2. “関係線を引く対象”にIDを付ける（後工程が爆速になる）

* [ ] 各エンティティ（`.table`）に **ユニークID**を付与

  * 例）`id="E-sales-order"`, `id="E-sales-customer"` など
* [ ] 可能なら `data-system="sales"` なども付与（将来、線の色分けや凡例に活かせる）

### A-3. 鳥瞰で描く「主要関係」をリスト化（線を“全部”引かない）

**鳥瞰は“議論に必要な主要関係だけ”**が正解なので、最初から絞ります。

* [ ] 販売：**顧客 → 受注 → 出荷（売上） → 請求 → 入金**
* [ ] 購買：**仕入先 → 発注 → 入荷 → 支払**
* [ ] SCM：**SCM品目 → 統合在庫**
* [ ] SCM品目 →（販売品目 / 購買品目 / 生産品目）※「同一品目概念」見せたいなら超効果大
* [ ] 会計：**入金/支払/売上/購買 → 仕訳**（会計連携の“芯”だけ）

### A-4. 関係線（SVGレイヤ）を配置して引く

* [ ] `<svg class="relations">` を `.canvas-wrapper` に absolute で重ねる
* [ ] まずは **5〜10本だけ**引いて、上司レビューに出せる状態にする
* [ ] 線が交差しやすい箇所は「L字（直交）配線」を優先（読みやすさ最優先）

  * SVGなら `<path d="M ... L ... L ...">` で実現

---

## B. 骨格データモデル図（PK/FK・多重度の“見える化”が主戦場）

### B-1. 色ルールのブレを直す（レビュー指摘の即応）

* [ ] 計画系は黄色、取引系は水色、マスタはピンクを厳守

  * 現状、**購買（調達）計画が水色、購買発注が黄色**になっているので修正候補です。

### B-2. PK/FK表現ルールをテンプレに組み込む（“骨格”として必須）

* [ ] 属性の表示形式を統一（例）

  * `PK: 購買計画id`
  * `FK: 品目cd → SCM.部品cd`（参照先も書く）
* [ ] CSSクラスで見分けが付くようにする

  * `.pk { font-weight: 700; text-decoration: underline; }`
  * `.fk { font-weight: 700; }`＋右に参照先小文字

### B-3. リレーション線＋多重度を追加（骨格の“裏取り”）

* [ ] 主要エンティティ間に線を追加

  * 例）受注 1 ─ N 出荷、受注 1 ─ N 売上（業務次第で調整）
  * 例）発注 1 ─ N 入庫（入庫=入荷/入庫の定義統一も必要）
* [ ] 線端に多重度ラベル（`1`, `N`, `0..1`）を表示
* [ ] FK項目と関係線が矛盾しないかをチェック（骨格の目的）

---

## C. 詳細テンプレ（“DBに繋ぐ強度”を上げる）

※今回はファイル未提示ですが、上司レビューの「傘」をそのままタスク化します。

* [ ] 多重度・任意性（必須/任意）を必ず表現
* [ ] サブタイプ（店頭受注/ネット受注）を

  * [ ] 排他/併存
  * [ ] 識別子（PK）共有/別
  * [ ] 親子の必須関係
    が分かる記法に統一
* [ ] 記号（`*`, `C*`, `()`, `<>`）の凡例をテンプレ固定枠に追加
* [ ] PK/UK/FK欄を分けて揺れを吸収できる器にする

---

## 実装方式（HTML/CSSのみ）のおすすめ：SVGオーバーレイ

「格子線ではなく、エンティティとリレーションを表現したい」という目的に一番素直です（JS不要）。

### 最小サンプル（考え方）

```html
<div class="canvas-wrapper">
  <!-- 既存の .canvas（エンティティ群） -->

  <!-- 関係線レイヤ（SVG） -->
  <svg class="relations" viewBox="0 0 1360 900" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
        <path d="M0,0 L10,5 L0,10 Z"></path>
      </marker>
    </defs>

    <!-- 例：顧客 → 受注（座標は手で調整） -->
    <path class="rel rel-flow" marker-end="url(#arrow)"
          d="M 980 650 L 980 690 L 1010 690"></path>
    <text class="rel-label" x="985" y="685">1–N</text>
  </svg>
</div>
```

```css
.canvas-wrapper { position: relative; }

.relations{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
}

.rel{ fill:none; stroke:#222; stroke-width:2.5; }
.rel-flow{ stroke-width:3; }
.rel-ref{ stroke-dasharray:6 4; opacity:.9; }

.rel-label{
  font-size:12px;
  fill:#111;
  paint-order: stroke;
  stroke:#fff;
  stroke-width:4px; /* 白縁取りで線の上でも読める */
}
```

**重要な割り切り（HTML/CSSのみの制約）：**
エンティティの位置から線を“自動追従”するのはJSなしだと難しいので、テンプレとしては **(1)レイアウトをある程度固定**し、**(2)線の座標は手調整で管理**するのが現実解です。
→ その代わり、「主要な線だけ」に絞る鳥瞰の方針と相性が良いです。

---

## 各テンプレの「完了条件」（上司レビューに通しやすい形）

最後に、作業がブレないよう Done を置きます。

### 鳥瞰（“鳥瞰として成立”のDone）

* [ ] 格子線が“関係線”に見えない（または撤去済み）
* [ ] 主要関係が **最低5〜10本**入っている
* [ ] 線の意味（実線/点線/太線など）が凡例で説明されている
* [ ] 図を見て「この関係はシステム跨ぎだ」と分かる

### 骨格（“裏取り”できるDone）

* [ ] 全主要エンティティでPKが明示
* [ ] 主要FKが「参照先つき」で明示
* [ ] 線とFKと多重度が矛盾しない
* [ ] 色分けルールが一貫している

---