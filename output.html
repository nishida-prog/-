<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{#meta}}{{title}}{{/meta}}</title>
  <style>
    :root {
      {{#styles}}
      {{#colors}}
      --border: {{border}};
      --lane-bg: {{lane_bg}};
      --body-bg: {{body_bg}};
      --text-color: {{text}};
      {{/colors}}
      --lane-border: {{lane_border}}px;
      {{#font_family}}
      --font-family: {{.}};
      {{/font_family}}
      {{#types}}
      --type-{{key}}: {{color}};
      {{/types}}
      {{/styles}}
      {{#layout}}
      {{#grid}}
      --grid-width: {{width}}px;
      --grid-height: {{height}}px;
      {{/grid}}
      {{/layout}}
      {{#lanes}}
      --lane-{{id}}-cx: calc({{x}}px + {{width}}px / 2);
      --lane-{{id}}-cy: calc({{y}}px + {{height}}px / 2);
      {{/lanes}}
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: var(--font-family, "Hiragino Sans", "Noto Sans JP", sans-serif);
      background: var(--body-bg);
      color: var(--text-color);
    }
    main {
      width: var(--grid-width, 1180px);
      margin: 10px auto 20px;
    }
    .legend {
      width: var(--grid-width, 1180px);
      margin: 0 auto 10px;
      font-size: 13px;
      color: var(--text-color);
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      margin-right: 16px;
    }
    .legend-item:last-of-type { margin-right: 0; }
    .legend-swatch {
      width: 14px;
      height: 14px;
      border: 1px solid #999;
      border-radius: 2px;
      margin-right: 6px;
    }
    {{#styles}}
    {{#types}}
    .legend-swatch.type-{{key}} { background: var(--type-{{key}}); }
    {{/types}}
    {{/styles}}
    .legend-swatch.lane { background: var(--lane-bg); border-color: var(--border); }
    .legend-swatch.border { background: #ffffff; border-color: var(--border); }
    .grid {
      position: relative;
      width: var(--grid-width, 1180px);
      height: var(--grid-height, 920px);
    }
    .lanes-layer { position: absolute; inset: 0; }
    .lane {
      position: absolute;
      border: var(--lane-border) solid var(--border);
      background: var(--lane-bg);
      color: var(--text-color);
      padding: 6px;
      box-sizing: border-box;
    }
    .lane-title {
      display: block;
      color: var(--border);
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 6px;
    }
    .card {
      display: inline-flex;
      align-items: center;
      padding: 6px 10px;
      border-radius: 3px;
      border: 1px solid var(--border);
      font-size: 13px;
      font-weight: 700;
      margin: 4px 6px 4px 0;
      color: #000;
      white-space: normal;
      line-height: 1.3;
      word-break: keep-all;
      max-width: calc(100% - 12px);
      min-width: 64px;
    }
    {{#styles}}
    {{#types}}
    .card.type-{{key}} { background: var(--type-{{key}}); }
    {{/types}}
    {{/styles}}
    .arrows {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: visible;
    }
    .arrows path,
    .arrows line.link {
      stroke: var(--border);
      stroke-width: 2.2;
      fill: none;
      marker-end: url(#arrowhead);
    }
  </style>
</head>
<body>
  <main>
    <div class="legend" aria-live="polite">
      {{#styles}}
      {{#types}}
      <span class="legend-item">
        <span class="legend-swatch type-{{key}}"></span>{{label}}
      </span>
      {{/types}}
      {{/styles}}
      {{#legend}}
        {{#items}}
        <span class="legend-item">
          <span class="legend-swatch {{key}}"></span>{{label}}
        </span>
        {{/items}}
      {{/legend}}
    </div>
    <div class="grid">
      <svg class="arrows" width="var(--grid-width, 1180)" height="var(--grid-height, 920)" viewBox="0 0 {{#layout}}{{#grid}}{{width}}{{/grid}}{{/layout}}{{^layout}}1180{{/layout}} {{#layout}}{{#grid}}{{height}}{{/grid}}{{/layout}}{{^layout}}920{{/layout}}" aria-hidden="true">
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto" markerUnits="strokeWidth">
            <polygon points="0 0, 10 4, 0 8" fill="var(--border)"></polygon>
          </marker>
        </defs>
        {{#connections}}
        <line class="link" x1="var(--lane-{{from}}-cx)" y1="var(--lane-{{from}}-cy)" x2="var(--lane-{{to}}-cx)" y2="var(--lane-{{to}}-cy)"></line>
        {{/connections}}
        {{#arrows}}
        <path d="{{path}}"></path>
        {{/arrows}}
      </svg>
      <div class="lanes-layer">
        {{#lanes}}
        <section class="lane" style="left:{{x}}px; top:{{y}}px; width:{{width}}px;{{#height}} height:{{height}}px;{{/height}}">
          <span class="lane-title">{{label}}</span>
          {{#groups}}
          <div{{#marginTop}} style="margin-top: {{marginTop}}px;"{{/marginTop}}>
            {{#items}}
            <div class="card type-{{type}}" style="{{#block}}display:block;{{/block}}{{#marginTop}}margin-top: {{marginTop}}px;{{/marginTop}}{{#marginLeft}}margin-left: {{marginLeft}}px;{{/marginLeft}}">{{label}}</div>
            {{/items}}
          </div>
          {{/groups}}
        </section>
        {{/lanes}}
      </div>
    </div>
  </main>
</body>
</html>
